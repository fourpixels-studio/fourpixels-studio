{% extends 'base.html' %}
{% block body %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<div class="container-xxl py-5 wow fadeInUp" data-wow-delay="0.1s">
    <div class="container px-lg-5 text-start">
        <div class="row gy-5 justify-content-center">
            
            <!-- Hitcount views start -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold">Page Views</h1>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th scope="col">Page</th>
                            <th scope="col">Views</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Home</td>
                            <td>{{ home.get_hit_count }}</td>
                        </tr>
                        <tr>
                            <td>About</td>
                            <td>{{ about.get_hit_count }}</td>
                        </tr>
                        <tr>
                            <td>Contact</td>
                            <td>{{ contact_page.get_hit_count }}</td>
                        </tr>
                        {% for project in projects %}
                        <tr>
                            <td>{{ project.name }}</td>
                            <td>{{ project.get_hit_count }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Hitcount views end -->

            <!-- Remixes start -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold">Remixes</h1>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th scope="col">Title</th>
                            <th scope="col">Views</th>
                            <th scope="col">Video</th>
                            <th scope="col">Audio</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for remix in remixes %}
                        <tr>
                            <td>{{ remix.title }}</td>
                            <td>{{ remix.get_hit_count }}</td>
                            <td>{{ remix.video_download_count }}</td>
                            <td>{{ remix.audio_download_count }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Remixes end -->

            <!-- blogs -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold">Blogs</h1>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                        <th scope="col">Title</th>
                        <th scope="col">Category</th>
                        <th scope="col">Views</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for blog in blogs %}
                        <tr>
                            <td>{{ blog.title }}</td>
                            <td>{{ blog.category }}</td>
                            <td>{{ blog.get_hit_count }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- End of blogs -->

            <!-- Newsletters -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold"><span>{{ newsletters_count }}</span> Newsletters</h1>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for newsletter in newsletters %}
                        <tr>
                            <td>
                                <span>{{ newsletter.email }}</span><br>
                                <span>{{ newsletter.date_added }}</span>

                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- End of newsletters -->

            <!-- Contacts -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold"><span>{{ contacts_count }}</span> Contacts</h1>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                        <th scope="col-3">Contact</th>
                        <th scope="col-6">Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contact in contacts %}  
                        <tr>
                            <td>
                                <span>{{ contact.name }}</span><br>
                                <span>{{ contact.email }}</span><br>
                                <span>{{ contact.phone_number }}</span><br>
                                <span class="badge" style="background-color: grey;">{{ contact.date|timesince }} ago</span>
                            </td>
                            <td>{{ contact.message }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- End of contacts -->

            <!-- Projects Views Chart -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold">Projects Views Chart</h1>
                <div id="projects-views-chart"></div>
            </div>
            <!-- End of Projects Views Chart -->

            <!-- Page Views Chart -->
            <div class="col-12 table-responsive">
                <h1 class="display-3 fw-bold">Chart</h1>
                <div id="page-views-chart"></div>
            </div>
            <!-- End of Page Views Chart -->

        </div>
    </div>
</div>


<script>
    // Chart for page views
    var options1 = {
        chart: {
            type: 'bar',
            // height: 1000
        },
        series: [{
            name: 'Views',
            data: ["{{ home.get_hit_count }}", "{{ about.get_hit_count }}", "{{ contact_page.get_hit_count }}"]
        }],
        xaxis: {
            categories: ["Home", "About", "Contact"]
        },
        plotOptions: {
            bar: {
            distributed: true
            }
        }
    }

    var pageViewsChart = new ApexCharts(document.querySelector("#page-views-chart"), options1);
    pageViewsChart.render();

    // Parse the JSON data passed from the view
    var projectsData = JSON.parse('{{ projects_data|escapejs }}');
    
    // Extract project names and hit counts
    var projectNames = projectsData.map(project => project.name);
    var projectHitCounts = projectsData.map(project => project.get_hit_count);

    // Options for the projects chart
    var options = {
        chart: {
            type: 'bar',
            // height: 1000
        },
        series: [{
            name: 'Views',
            data: projectHitCounts
        }],
        xaxis: {
            categories: projectNames
        },
        plotOptions: {
            bar: {
            distributed: true
            }
        }
    };

    // Render the chart
    var projectsViewsChart = new ApexCharts(document.querySelector("#projects-views-chart"), options);
    projectsViewsChart.render();
</script>
{% endblock %}
